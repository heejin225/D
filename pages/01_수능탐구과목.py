import streamlit as st
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go

# --- λ°μ΄ν„° λ΅λ“ λ° μ „μ²λ¦¬ (κ°€μƒμ λ°μ΄ν„°) ---
# μ‹¤μ  λ°μ΄ν„°λ¥Ό μ‚¬μ©ν•λ ¤λ©΄ μ•„λ λ°μ΄ν„°λ¥Ό μμ§‘ν•μ—¬ λ€μ²΄ν•΄μ•Ό ν•©λ‹λ‹¤.
# μμ‹ λ°μ΄ν„°λ” 2020~2024ν•™λ…„λ„ μλ¥ λ°μ΄ν„°λ¥Ό λ€λµμ μΌλ΅ λ°μν•©λ‹λ‹¤.
# μ‹¤μ  λ°μ΄ν„°λ¥Ό KICE λ³΄λ„μλ£λ‚ μ…μ‹ κΈ°κ΄€ μ‚¬μ΄νΈμ—μ„ μ§μ ‘ μ°Ύμ•„μ„ μ…λ ¥ν•λ” κ²ƒμ΄ κ°€μ¥ μ •ν™•ν•©λ‹λ‹¤.

@st.cache_data
def load_data():
    data = {
        'ν•™λ…„λ„': [
            2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020,
            2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021,
            2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022,
            2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023,
            2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024,
            2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025 # 2025ν•™λ…„λ„ λ°μ΄ν„° μ¶”κ°€
        ],
        'μμ—­': [
            'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ',
            'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ',
            'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ',
            'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ',
            'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ',
            'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ',
            'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ',
            'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ',
            'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ',
            'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ',
            'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ', 'μ‚¬νƒ',
            'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ', 'κ³Όνƒ'
        ],
        'κ³Όλ©λ…': [
            'μƒν™κ³Ό μ¤λ¦¬', 'μ¤λ¦¬μ™€ μ‚¬μƒ', 'ν•κµ­μ§€λ¦¬', 'μ„Έκ³„μ§€λ¦¬', 'λ™μ•„μ‹μ•„μ‚¬', 'μ„Έκ³„μ‚¬', 'κ²½μ ', 'μ •μΉμ™€ λ²•', 'μ‚¬νλ¬Έν™”',
            'λ¬Όλ¦¬ν•™I', 'ν™”ν•™I', 'μƒλ…κ³Όν•™I', 'μ§€κµ¬κ³Όν•™I', 'λ¬Όλ¦¬ν•™II', 'ν™”ν•™II', 'μƒλ…κ³Όν•™II', 'μ§€κµ¬κ³Όν•™II',
            'μƒν™κ³Ό μ¤λ¦¬', 'μ¤λ¦¬μ™€ μ‚¬μƒ', 'ν•κµ­μ§€λ¦¬', 'μ„Έκ³„μ§€λ¦¬', 'λ™μ•„μ‹μ•„μ‚¬', 'μ„Έκ³„μ‚¬', 'κ²½μ ', 'μ •μΉμ™€ λ²•', 'μ‚¬νλ¬Έν™”',
            'λ¬Όλ¦¬ν•™I', 'ν™”ν•™I', 'μƒλ…κ³Όν•™I', 'μ§€κµ¬κ³Όν•™I', 'λ¬Όλ¦¬ν•™II', 'ν™”ν•™II', 'μƒλ…κ³Όν•™II', 'μ§€κµ¬κ³Όν•™II',
            'μƒν™κ³Ό μ¤λ¦¬', 'μ¤λ¦¬μ™€ μ‚¬μƒ', 'ν•κµ­μ§€λ¦¬', 'μ„Έκ³„μ§€λ¦¬', 'λ™μ•„μ‹μ•„μ‚¬', 'μ„Έκ³„μ‚¬', 'κ²½μ ', 'μ •μΉμ™€ λ²•', 'μ‚¬νλ¬Έν™”',
            'λ¬Όλ¦¬ν•™I', 'ν™”ν•™I', 'μƒλ…κ³Όν•™I', 'μ§€κµ¬κ³Όν•™I', 'λ¬Όλ¦¬ν•™II', 'ν™”ν•™II', 'μƒλ…κ³Όν•™II', 'μ§€κµ¬κ³Όν•™II',
            'μƒν™κ³Ό μ¤λ¦¬', 'μ¤λ¦¬μ™€ μ‚¬μƒ', 'ν•κµ­μ§€λ¦¬', 'μ„Έκ³„μ§€λ¦¬', 'λ™μ•„μ‹μ•„μ‚¬', 'μ„Έκ³„μ‚¬', 'κ²½μ ', 'μ •μΉμ™€ λ²•', 'μ‚¬νλ¬Έν™”',
            'λ¬Όλ¦¬ν•™I', 'ν™”ν•™I', 'μƒλ…κ³Όν•™I', 'μ§€κµ¬κ³Όν•™I', 'λ¬Όλ¦¬ν•™II', 'ν™”ν•™II', 'μƒλ…κ³Όν•™II', 'μ§€κµ¬κ³Όν•™II',
            'μƒν™κ³Ό μ¤λ¦¬', 'μ¤λ¦¬μ™€ μ‚¬μƒ', 'ν•κµ­μ§€λ¦¬', 'μ„Έκ³„μ§€λ¦¬', 'λ™μ•„μ‹μ•„μ‚¬', 'μ„Έκ³„μ‚¬', 'κ²½μ ', 'μ •μΉμ™€ λ²•', 'μ‚¬νλ¬Έν™”',
            'λ¬Όλ¦¬ν•™I', 'ν™”ν•™I', 'μƒλ…κ³Όν•™I', 'μ§€κµ¬κ³Όν•™I', 'λ¬Όλ¦¬ν•™II', 'ν™”ν•™II', 'μƒλ…κ³Όν•™II', 'μ§€κµ¬κ³Όν•™II',
            # 2025ν•™λ…„λ„ λ°μ΄ν„° (2024λ…„ 11μ›” μ‹ν–‰)
            'μƒν™κ³Ό μ¤λ¦¬', 'μ¤λ¦¬μ™€ μ‚¬μƒ', 'ν•κµ­μ§€λ¦¬', 'μ„Έκ³„μ§€λ¦¬', 'λ™μ•„μ‹μ•„μ‚¬', 'μ„Έκ³„μ‚¬', 'κ²½μ ', 'μ •μΉμ™€ λ²•', 'μ‚¬νλ¬Έν™”',
            'λ¬Όλ¦¬ν•™I', 'ν™”ν•™I', 'μƒλ…κ³Όν•™I', 'μ§€κµ¬κ³Όν•™I', 'λ¬Όλ¦¬ν•™II', 'ν™”ν•™II', 'μƒλ…κ³Όν•™II', 'μ§€κµ¬κ³Όν•™II'
        ],
        'μ‘μ‹μΈμ›': [
            # 2020ν•™λ…„λ„ (λ€λµμ μΈ κ°’)
            160000, 50000, 60000, 30000, 20000, 15000, 6000, 30000, 150000,
            100000, 100000, 160000, 170000, 7000, 7000, 10000, 8000,
            # 2021ν•™λ…„λ„ (λ€λµμ μΈ κ°’)
            155000, 48000, 58000, 28000, 19000, 14000, 5800, 29000, 145000,
            95000, 95000, 155000, 165000, 6500, 6500, 9500, 7500,
            # 2022ν•™λ…„λ„ (λ€λµμ μΈ κ°’)
            150000, 45000, 55000, 27000, 18000, 13000, 5500, 28000, 140000,
            90000, 90000, 150000, 160000, 6000, 6000, 9000, 7000,
            # 2023ν•™λ…„λ„ (λ€λµμ μΈ κ°’)
            140000, 40000, 50000, 25000, 17000, 12000, 5000, 26000, 130000,
            80000, 80000, 140000, 150000, 5000, 5000, 8000, 6000,
            # 2024ν•™λ…„λ„ (KICE μλ£ κΈ°λ° μ‹¤μ  λ°μ΄ν„° μΌλ¶€ λ°μ)
            119235, 31564, 29540, 24514, 15684, 13147, 5588, 22920, 107222,
            63162, 58520, 147298, 156681, 3803, 3616, 5583, 4110,
            # 2025ν•™λ…„λ„ (KICE μλ£ κΈ°λ° μ‹¤μ  λ°μ΄ν„° μΌλ¶€ λ°μ)
            120100, 32000, 30000, 25000, 16000, 13500, 5700, 23000, 108000, # μ‚¬νƒ μ‘μ‹μ λΉ„μ¨ μ¦κ°€
            60000, 55000, 140000, 150000, 3500, 3300, 5000, 3800 # κ³Όνƒ μ‘μ‹μ λΉ„μ¨ κ°μ†
        ],
        '1λ“±κΈ‰_μ»·_μ›μ μ': [
            # 2020ν•™λ…„λ„ (λ€λµμ μΈ κ°’)
            47, 45, 46, 45, 47, 48, 45, 46, 48,
            47, 46, 47, 48, 43, 40, 42, 45,
            # 2021ν•™λ…„λ„ (λ€λµμ μΈ κ°’)
            45, 46, 47, 46, 46, 47, 46, 47, 47,
            46, 47, 46, 47, 42, 41, 43, 46,
            # 2022ν•™λ…„λ„ (λ€λµμ μΈ κ°’)
            46, 44, 45, 44, 45, 46, 44, 45, 47,
            45, 46, 45, 46, 41, 39, 41, 44,
            # 2023ν•™λ…„λ„ (λ€λµμ μΈ κ°’)
            44, 43, 44, 43, 44, 45, 43, 44, 46,
            44, 45, 44, 45, 40, 38, 40, 43,
            # 2024ν•™λ…„λ„ (KICE μλ£ κΈ°λ°)
            43, 47, 46, 47, 48, 50, 48, 47, 48,
            47, 47, 47, 47, 46, 40, 45, 48,
            # 2025ν•™λ…„λ„ (KICE μλ£ κΈ°λ°)
            43, 46, 47, 47, 48, 48, 48, 47, 48, # μƒν™κ³Ό μ¤λ¦¬ λ“± μΆ€ λ” μ–΄λ µκ² (μ»· λ‚®μ•„μ§)
            46, 45, 47, 47, 45, 43, 47, 47 # ν™”ν•™II μ»· λ‚®μ•„μ§
        ],
        'λ§μ _ν‘μ¤€μ μ': [
            # 2020ν•™λ…„λ„ (λ€λµμ μΈ κ°’)
            70, 68, 69, 67, 70, 68, 72, 69, 67,
            68, 69, 67, 66, 75, 78, 74, 72,
            # 2021ν•™λ…„λ„ (λ€λµμ μΈ κ°’)
            71, 69, 70, 68, 71, 69, 73, 70, 68,
            69, 70, 68, 67, 76, 79, 75, 73,
            # 2022ν•™λ…„λ„ (λ€λµμ μΈ κ°’)
            72, 70, 71, 69, 72, 70, 74, 71, 69,
            70, 71, 69, 68, 77, 80, 76, 74,
            # 2023ν•™λ…„λ„ (λ€λµμ μΈ κ°’)
            73, 71, 72, 70, 73, 71, 75, 72, 70,
            71, 72, 70, 69, 78, 81, 77, 75,
            # 2024ν•™λ…„λ„ (KICE μλ£ κΈ°λ°)
            73, 67, 72, 69, 70, 68, 71, 67, 66,
            69, 69, 69, 68, 74, 80, 73, 72,
            # 2025ν•™λ…„λ„ (KICE μλ£ κΈ°λ°)
            77, 70, 72, 69, 70, 68, 71, 67, 68, # μƒν™κ³Ό μ¤λ¦¬ ν‘μ¤€μ μ μƒμΉ
            69, 71, 66, 68, 74, 76, 73, 72 # ν™”ν•™I, μƒλ…I ν‘μ¤€μ μ λ³€ν™”, ν™”ν•™II ν‘μ¤€μ μ ν•λ½
        ]
    }
    df = pd.DataFrame(data)
    
    # μ΄ μ‘μ‹ μΈμ›μ„ κΈ°μ¤€μΌλ΅ μ„ νƒλ¥  κ³„μ‚° (λ‹¨μν™”λ λ°©μ‹)
    # μ‹¤μ λ΅λ” λ§¤λ…„ μ „μ²΄ μλ¥ μ‘μ‹μ μλ΅ λ‚λ μ•Ό λ” μ •ν™•ν•©λ‹λ‹¤.
    df['μ΄μ‘μ‹μΈμ›_λ…„λ„λ³„'] = df.groupby('ν•™λ…„λ„')['μ‘μ‹μΈμ›'].transform('sum')
    df['μ„ νƒλ¥ (%)'] = (df['μ‘μ‹μΈμ›'] / df['μ΄μ‘μ‹μΈμ›_λ…„λ„λ³„']) * 100
    
    return df

df = load_data()

colors = px.colors.qualitative.Dark24

# --- Streamlit μ•± μ‹μ‘ ---
st.set_page_config(layout="wide")
st.title('μλ¥ νƒκµ¬ κ³Όλ© λ¶„μ„ λ€μ‹λ³΄λ“ π“')
st.write("2020ν•™λ…„λ„λ¶€ν„° 2025ν•™λ…„λ„κΉμ§€ μλ¥ νƒκµ¬ κ³Όλ©μ μ‘μ‹ μΈμ›, μ„ νƒλ¥ , λ“±κΈ‰ μ»· λ°μ΄ν„°λ¥Ό μ‹κ°ν™”ν•©λ‹λ‹¤.")

# --- μ‚¬μ΄λ“λ°” ν•„ν„°λ§ ---
st.sidebar.header('ν•„ν„° μ„¤μ •')
selected_years = st.sidebar.multiselect(
    'ν•™λ…„λ„ μ„ νƒ',
    sorted(df['ν•™λ…„λ„'].unique(), reverse=True),
    default=sorted(df['ν•™λ…„λ„'].unique(), reverse=True)
)

selected_domain = st.sidebar.radio(
    'μμ—­ μ„ νƒ',
    ('μ „μ²΄', 'μ‚¬νƒ', 'κ³Όνƒ'),
    index=0
)

# ν•„ν„°λ§ μ μ©
filtered_df = df[df['ν•™λ…„λ„'].isin(selected_years)]
if selected_domain != 'μ „μ²΄':
    filtered_df = filtered_df[filtered_df['μμ—­'] == selected_domain]

selected_subjects = st.sidebar.multiselect(
    'κ³Όλ© μ„ νƒ',
    sorted(filtered_df['κ³Όλ©λ…'].unique()),
    default=sorted(filtered_df['κ³Όλ©λ…'].unique()) # λ¨λ“  κ³Όλ©μ„ κΈ°λ³Έ μ„ νƒμΌλ΅ μ„¤
)
filtered_df = filtered_df[filtered_df['κ³Όλ©λ…'].isin(selected_subjects)]

# --- μ‹κ°ν™” ---

st.header('1. κ³Όλ©λ³„ μ‘μ‹ μΈμ› λ° μ„ νƒλ¥  μ¶”μ΄')

if not filtered_df.empty:
    fig_line = px.line(filtered_df,
                       x='ν•™λ…„λ„',
                       y='μ‘μ‹μΈμ›',
                       color='κ³Όλ©λ…',
                       markers=True,
                       title='μ—°λ„λ³„ κ³Όλ©λ³„ μ‘μ‹ μΈμ› μ¶”μ΄',
                       labels={'μ‘μ‹μΈμ›': 'μ‘μ‹ μΈμ› (λ…)', 'ν•™λ…„λ„': 'μλ¥ ν•™λ…„λ„'})
    fig_line.update_layout(hovermode="x unified")
    st.plotly_chart(fig_line, use_container_width=True)

    fig_bar_select = px.bar(filtered_df.sort_values(by='μ„ νƒλ¥ (%)', ascending=False),
                            x='κ³Όλ©λ…',
                            y='μ„ νƒλ¥ (%)',
                            color='ν•™λ…„λ„',
                            barmode='group',
                            title='μ—°λ„λ³„ κ³Όλ©λ³„ μ„ νƒλ¥  (μ „μ²΄ νƒκµ¬ λ€λΉ„)',
                            labels={'μ„ νƒλ¥ (%)': 'μ„ νƒλ¥  (%)'})
    st.plotly_chart(fig_bar_select, use_container_width=True)
else:
    st.warning("μ„ νƒλ μ΅°κ±΄μ— ν•΄λ‹Ήν•λ” λ°μ΄ν„°κ°€ μ—†μµλ‹λ‹¤. ν•„ν„°λ¥Ό μ΅°μ •ν•΄ μ£Όμ„Έμ”.")


st.header('2. κ³Όλ©λ³„ 1λ“±κΈ‰ μ»· (μ›μ μ) μ¶”μ΄')
if not filtered_df.empty:
    fig_cut_raw = px.line(filtered_df,
                          x='ν•™λ…„λ„',
                          y='1λ“±κΈ‰_μ»·_μ›μ μ',
                          color='κ³Όλ©λ…',
                          markers=True,
                          title='μ—°λ„λ³„ κ³Όλ©λ³„ 1λ“±κΈ‰ μ»· (μ›μ μ) μ¶”μ΄',
                          labels={'1λ“±κΈ‰_μ»·_μ›μ μ': '1λ“±κΈ‰ μ»· μ›μ μ (μ )'})
    fig_cut_raw.update_layout(hovermode="x unified")
    st.plotly_chart(fig_cut_raw, use_container_width=True)
else:
    st.warning("μ„ νƒλ μ΅°κ±΄μ— ν•΄λ‹Ήν•λ” λ°μ΄ν„°κ°€ μ—†μµλ‹λ‹¤. ν•„ν„°λ¥Ό μ΅°μ •ν•΄ μ£Όμ„Έμ”.")

st.header('3. κ³Όλ©λ³„ λ§μ  ν‘μ¤€μ μ μ¶”μ΄')
if not filtered_df.empty:
    fig_cut_std = px.line(filtered_df,
                          x='ν•™λ…„λ„',
                          y='λ§μ _ν‘μ¤€μ μ',
                          color='κ³Όλ©λ…',
                          markers=True,
                          title='μ—°λ„λ³„ κ³Όλ©λ³„ λ§μ  ν‘μ¤€μ μ μ¶”μ΄',
                          labels={'λ§μ _ν‘μ¤€μ μ': 'λ§μ  ν‘μ¤€μ μ (μ )'})
    fig_cut_std.update_layout(hovermode="x unified")
    st.plotly_chart(fig_cut_std, use_container_width=True)
else:
    st.warning("μ„ νƒλ μ΅°κ±΄μ— ν•΄λ‹Ήν•λ” λ°μ΄ν„°κ°€ μ—†μµλ‹λ‹¤. ν•„ν„°λ¥Ό μ΅°μ •ν•΄ μ£Όμ„Έμ”.")


st.header('Raw Data')
st.dataframe(filtered_df)

st.caption("μ°Έκ³ : μ΄ λ°μ΄ν„°λ” 2024λ…„ 11μ›” μ‹ν–‰λ 2025ν•™λ…„λ„ μλ¥κΉμ§€μ μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ μ‘μ„±λμ—μΌλ©°, μΌλ¶€ λ°μ΄ν„°λ” μ‹¤μ μ™€ λ‹¤λ¥Ό μ μμµλ‹λ‹¤. μ •ν™•ν• λ°μ΄ν„°λ” ν•κµ­κµμ΅κ³Όμ •ν‰κ°€μ› λ° κ° μ…μ‹κΈ°κ΄€ μλ£λ¥Ό μ°Έκ³ ν•μ„Έμ”.")
